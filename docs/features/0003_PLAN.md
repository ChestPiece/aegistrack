# MERN Stack Backend Implementation with Supabase Auth

## Overview

Transition the application backend to a MERN (MongoDB, Express, React, Node.js) stack. Supabase will be retained strictly for Authentication (User Management). All business logic and data storage will move to a custom Node.js/Express server connected to MongoDB.

## User Review Required

> [!IMPORTANT]
> This plan introduces a separate backend server. You will need to run both the Vite frontend (`npm run dev`) and the Express backend (e.g., `npm run server`) simultaneously.
> **Requirement**: Ensure you have a MongoDB connection string ready (local or Atlas).

## Proposed Changes

### Backend Setup

#### [NEW] [backend/package.json](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/backend/package.json)

Initialize a new Node.js project in a `backend` directory.

- **Dependencies**: `express`, `mongoose`, `cors`, `dotenv`, `helmet`, `morgan`
- **DevDependencies**: `nodemon`, `typescript`, `ts-node`, `@types/express`, `@types/node`

#### [NEW] [backend/src/server.ts](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/backend/src/server.ts)

Entry point for the Express application.

- Connect to MongoDB.
- Configure Middleware (CORS, JSON parsing).
- Mount API routes.

### Authentication & Security

#### [NEW] [backend/src/middleware/auth.ts](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/backend/src/middleware/auth.ts)

Middleware to verify Supabase JWT tokens attached to requests.

- Extract Bearer token from `Authorization` header.
- Verify token using Supabase Admin client or JWT secret.
- Attach user info to the request object.

### Database Schema (Mongoose)

#### [NEW] [backend/src/models/User.ts](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/backend/src/models/User.ts)

- Schema for user profile data (syncs with Supabase Auth ID).

#### [NEW] [backend/src/models/Project.ts](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/backend/src/models/Project.ts)

- Schema for projects.

#### [NEW] [backend/src/models/Task.ts](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/backend/src/models/Task.ts)

- Schema for tasks, referencing Projects and Users.

### API Routes

#### [NEW] [backend/src/routes/index.ts](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/backend/src/routes/index.ts)

- `/api/projects` - CRUD for projects.
- `/api/tasks` - CRUD for tasks.
- `/api/users` - User profile management.

### Frontend Integration

#### [NEW] [src/services/api.ts](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/src/services/api.ts)

- Create an Axios instance or fetch wrapper.
- Automatically attach the Supabase Access Token to every request.

#### [MODIFY] [src/pages/\*](file:///c:/Users/Anas/Desktop/aegistrack-project-hub/src/pages)

- Refactor pages (Dashboard, Projects, Tasks) to use `api.ts` instead of `supabase.from(...)`.

## Verification Plan

### Manual Verification

1. **Backend Startup**:
   - Run `npm run dev` in `backend/`.
   - Verify connection to MongoDB.
2. **Auth Integration**:
   - Make a request from Frontend -> Backend.
   - Verify Backend decodes the Supabase token correctly.
3. **Data Flow**:
   - Create a Task in Frontend.
   - Verify it appears in MongoDB.
   - Verify it appears in the Frontend list.
